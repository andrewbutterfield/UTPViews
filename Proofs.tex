\section{Proofs}\label{sec:proofs}



\subsection{Proof of \textsf{HL-X-red}}
\RLEQNS{
  && \HL(X(E|a|R|A))
\EQ{\eref{HL-def}}
\\&& \exists ls,ls' @ X(E|a|R|A)
\EQ{\eref{X-def}}
\\&& \exists ls,ls' @
     ls(E) \land s' \in \sem a s \land ls' = (ls \setminus R) \cup A
\EQ{1pt-law, $ls'$, noting that $E$ is ground}
\\&& \exists ls @
     ls(E) \land s' \in \sem a s
\EQ{reduce $ls$ scope}
\\&& (\exists ls @ ls(E)) \land s' \in \sem a s
\EQ{witness: $ls=E$}
\\&& s' \in \sem a s
}


\subsection{Proof of \textsf{HL-X-sub-red}}

We start with a lemma \elabel{X-gnd-subst}:
\RLEQNS{
  && X(E|a|R|A)[G,I,O/g,in,out]
\EQ{\eref{X-def}}
\\&& (ls(E) \land s' \in \sem a s \land ls' = (ls \setminus R) \cup A)
     [G,I,O/g,in,out]
\EQ{substitution}
\\&& ls(E[G,I,O/g,in,out])
    \land s' \in \sem a s
\\ &\land& ls' = (ls \setminus R[G,I,O/g,in,out]) \cup A[G,I,O/g,in,out]
\EQ{\eref{X-def}}
\\&& X(E[G,I,O/g,in,out]|a|R[G,I,O/g,in,out]|A[G,I,O/g,in,out])
}

\RLEQNS{
  && \HL(X(E|a|R|A)[G,I,O/g,in,out])
\EQ{\eref{X-gnd-subst}}
\\&& \HL(X(E[G,I,O/g,in,out]|a|R[G,I,O/g,in,out]|A[G,I,O/g,in,out]))
\EQ{\eref{HL-X-red}, provided $E[G,I,O/g,in,out]$ is ground.}
\\&& s' \in \sem a s
}


\subsection{Proof of \textsf{HL-or-distr}}
\RLEQNS{
  && \HL(A \lor B)
\EQ{\eref{HL-def}}
\\&& \exists ls,ls' @ A \lor B
\EQ{$\exists$-$\lor$-distr}
\\&& (\exists ls,ls' @ A) \lor (\exists ls,ls' @ B)
\EQ{\eref{HL-def}}
\\&& \HL(A) \lor \HL{B}
}

\subsection{Proof of \textsf{HL-I-and-skip}}
\RLEQNS{
  && \HL(I \land \Skip)
\EQ{\eref{UTP-skip-def}}
\\&& \HL(I \land ls'=ls \land s'=s)
\EQ{\eref{HL-def}}
\\&& \exists ls,ls' @ I \land ls'=ls \land s'=s
\EQ{1-pt, $ls'=ls$}
\\&& \exists ls @ I[ls/ls'] \land s'=s
\EQ{$ls'$ not in $I$}
\\&& \exists ls @ I \land s'=s
\EQ{shrink scope of $ls$, expand $I$ shorthand (a bit)}
\\&& (\exists ls @ ls \textbf{ lsat } I) \land s'=s
\EQ{witness, $ls=\emptyset$}
\\&& s'=s
\EQ{\eref{ii-def}}
\\&& ii
}


\subsection{Proof of \textsf{HL-I-and-X}}
\RLEQNS{
  && \HL(I \land X(E|a|R|A) \land S)
\EQ{\eref{X-def}}
\\&& \HL(I \land ls(E) \land a \land ls'=(ls\setminus R)\cup A \land S)
\EQ{\eref{HL-def}}
\\&& \exists ls,ls' @ I \land ls(E) \land a \land ls'=(ls\setminus R)\cup A \land S)
\EQ{1-pt, $ls'=(ls\setminus R)\cup A$, noting $E$, $S$ are ground}
\\&& \exists ls @ I \land ls(E) \land a \land S)
\EQ{shrink scope of $ls$}
\\&& (\exists ls @ I \land ls(E)) \land a \land S)
\EQ{witness $ls=E$, assuming that $E \textbf{ lsat } I$}
\\&& a \land S
}

\subsection{Proof of \textsf{HL-seq-s-distr}}

We start with the lhs, in which $A(a_i)$ is shorthand for $A(E_i|a_i|N_i)$,
and similarly for $A(b_j)$, and $X(a_i\seq_s b_j)$.
\RLEQNS{
  && \HL(P \seq Q)
\EQ{expand into normal form}
\\&& \HL\left(~I \land (\Skip \lor \bigvee A(a_i))
                \seq
               J \land (\Skip \lor \bigvee A(b_j))~\right)
\EQ{\eref{nf-seq}}
\\&& \HL\left(~I \land J \land (\Skip \lor \bigvee (A(a_i) \seq A(b_j)))~\right)
\EQ{\ecite{and-or-distr}}
\\&& \HL\left(~I \land J \land \Skip
\lor \bigvee (I \land J \land  (A(a_i) \seq A(b_j)))~\right)
\EQ{\eref{HL-or-distr}}
\\&& \HL(~I \land J \land \Skip)
\lor \bigvee \HL(I \land J \land  (A(a_i) \seq A(b_j)))
\EQ{\eref{HL-I-and-skip}}
\\&& I \land J \land ii
\lor \bigvee \HL(I \land J \land  (A(a_i) \seq A(b_j)))
\EQ{Assume $A(a_i) \seq A(b_j) = X(a_i\seq_s b_j) \land S_{ij}$}
\\&& I \land J \land ii
\lor \bigvee \HL(I \land J \land  X(a_i\seq_s b_j) \land S_{ij})
\EQ{\eref{HL-I-and-X}}
\\&& I \land J \land ii
\lor \bigvee (I \land J \land (a_i\seq_s b_j) \land S_{ij})
}

Now, the rhs:
\RLEQNS{
  && \HL(P) \seq_s \HL(Q)
}
