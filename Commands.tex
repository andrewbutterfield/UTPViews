\section{Commands}\label{sec:commands}



\subsection{Syntax}

\begin{eqnarray*}
   a &\in& \Atom{}
\\ g &:& Gen
\\ \ell &:& Gen \fun Lbl
\\ G &::=&  g \mid G_{:} \mid G_1 \mid G_2
\\ L &::=& \ell_G
\end{eqnarray*}

\begin{eqnarray*}
   P &::= & c \pgrd a
\\   &\mid& \cskip
\\   &\mid& P \cseq P
\\   &\mid& P \parallel P
\\   &\mid& P+P
\\   &\mid& P^*
\\   &\mid& P \dcond c P
\\   &\mid& c \ddo P
\end{eqnarray*}

\subsection{Domains}
\begin{eqnarray*}
   s &\in& \mathcal S
\\ \sem{-} &:& \Atom{} \fun \mathcal S \fun \mathcal P(\mathcal S)
\end{eqnarray*}

\subsection{Alphabet}

\begin{eqnarray*}
   s, s' &:& \mathcal S
\\ ls, ls' &:& \mathcal P (Lbl)
\\ g &:& Gen
\\ in, out &:& Lbl
\end{eqnarray*}

\subsection{``Standard'' UTP Constructs}

\begin{eqnarray*}
   P \cond c Q
   &\defs&
   c \land P \lor \lnot c \land Q
\\ \Skip
   &\defs&
   s'= s \land ls'=ls
\\ P ; Q
   &\defs&
   \exists s_m,ls_m \bullet P[s_m,ls_m/s',ls'] \land Q[s_m,ls_m/s,ls]
\\ c * P
   &=&
   P ; c * P \cond c \Skip
\end{eqnarray*}

\subsection{Shorthands}

\begin{eqnarray*}
   ls(\ell) &\defs& \ell \in ls
\\ ls(L) &\defs& L \subseteq ls
\\ ls(\B\ell) &\defs& \ell \notin ls
\\ ls(\B L) &\defs& L \cap ls = \emptyset
\end{eqnarray*}

\subsection{Semantic Concepts}

\subsubsection{Basic Action}

\begin{eqnarray*}
   A(E|a|N)
   &\defs&
   ls(E) \land s' \in \sem a \land ls'=(ls\setminus E) \cup N
\end{eqnarray*}


\subsubsection{Wheels-within-Wheels}

\begin{eqnarray*}
   \W(P) &\defs& \true * (\Skip \lor P)
\\         &  =  & \bigvee_{i \in 0,\dots} \Skip \seq P^i
\end{eqnarray*}

\subsubsection{Label-Set Invariant}

\RLEQNS{
   i \in I_\tau &::=& \tau \mid \otimes(i,\ldots,i) \mid \cup (i,\ldots,i)
}

\RLEQNS{
   A(E|a|N) \textbf{ sat } I
   &\defs&
   E \textbf{ lsat } I \land N \textbf{ lsat } I
}

\RLEQNS{
   occ &:& \power \Int \fun I_\Int \fun I_\Bool
\\ occ_L~\ell &\defs& \ell \in L
\\ occ_L~\otimes(i_1,\ldots,i_n)
   &\defs&
   \otimes(occ_L~i_1,\ldots,occ_L~i_n)
\\ occ_L~\cup(i_1,\ldots,i_n)
   &\defs&
   \cup(occ_L~i_1,\ldots,occ_L~i_n)
}

\RLEQNS{
   occChk &:& I_\Bool \fun (\setof{ok,fail}\times \Bool)
\\ occChk(b) &\defs& (ok,true)
\\ occChk(\cup(i_1,\ldots,i_n))
   &\defs&
   (fail,\_),
   \textbf{ if }\exists j @ occChk(i_j) = (fail,\_)
\\ && (ok,b_1 \lor \dots \lor b_n),
   \textbf{ if }\forall j @ occChk(i_j) = (ok,b_j)
\\ occChk(\otimes(i_1,\ldots,i_n))
   &\defs&
   (fail,\_),
   \textbf{ if }\exists j @ occChk(i_j) = (fail,\_)
\\&& (fail,\_) \mbox{ if more than one $(ok,true)$}
\\&& (ok,false) \mbox{ if all are $(ok,false)$}
\\&& (ok,true) \mbox{ if  exactly one $(ok,true)$}
}



\subsection{Program Semantics}

\subsubsection{Guarded Atomic Action}

\RLEQNS{
 c \pgrd a &\defs&\W(c \land A(in|a|out)) \land [in|out]
}

\subsubsection{Sequential Composition}

\RLEQNS{
   P \cseq Q
   &\defs&
   \W(P[g_{:1},\ell_g/g,out] \lor Q[g_{:2},\ell_g/g,in])
   \land [in|\ell_g|out]
}

\subsubsection{Parallell Composition}

\RLEQNS{
   P \parallel Q
   &\defs&
   \W(\quad\phlor A(in|ii|\ell_{g1},\ell_{g2})
\\ && \qquad {}\lor
   P[g_{1::},\ell_{g1},\ell_{g1:}/g,in,out]
   \lor Q[g_{2::},\ell_{g2},\ell_{g2:}/g,in,out]
\\ && \qquad {}\lor
   A(\ell_{g1:},\ell_{g2:}|ii|out)~)
\\&& {} \land [in|(\ell_{g1}|\ell_{g1:}),(\ell_{g2}|\ell_{g2:})|out]
}


\subsubsection{Nondeterministic Choice}

\RLEQNS{
   P + Q
   &\defs&
   \W(\quad {}\phlor A(in|ii|\ell_{g1})
\\ && \qquad {} \lor
                     A(in|ii|\ell_{g2})
\\ && \qquad {} \lor
   P[g_{1:},\ell_{g1}/g,in] \lor Q[g_{2:},\ell_{g2}/g,in]~)
\\&& {} \land [in|\ell_{g1}|\ell_{g2}|out]
}

\subsubsection{Nondeterministic Loop}


\RLEQNS{
   P^*
   &\defs&
   \W(\quad  \phlor A(in|ii|out)
\\ && \qquad {}\lor A(in|ii|\ell_g)
\\ && \qquad {}\lor P[g_{:},\ell_g,in/g,in,out]~)
\\&& {} \land [in|\ell_g|out]
}

\subsubsection{Conditional Choice}

\RLEQNS{
   P \dcond c Q
   &\defs&
   \W(\quad {}\phlor c \land A(in|ii|\ell_{g1})
\\ && \qquad {} \lor
                     \lnot c \land A(in|ii|\ell_{g2})
\\ && \qquad {} \lor
   P[g_{1:},\ell_{g1}/g,in] \lor Q[g_{2:},\ell_{g2}/g,in]~)
\\&& {} \land [in|\ell_{g1}|\ell_{g2}|out]
}

\subsubsection{Conditional Loop}


\RLEQNS{
   c \ddo P
   &\defs&
   \W(\quad  \phlor \lnot c \land A(in|ii|out)
\\ && \qquad {}\lor c \land A(in|ii|\ell_g)
\\ && \qquad {}\lor P[g_{:},\ell_g,in/g,in,out]~)
\\&& {} \land [in|\ell_g|out]
}



